{% set PAYDF_TEMPLATE = config.PAYDF_TEMPLATE %}
{% set VARIABLE_TEMPLATE = config.VARIABLE_TEMPLATE %}

<div id="button-paydf-tables" data-col-headers='{{ col_headers|tojson | safe }}'>
    <table id="button-table">
        <tr>
            <td></td>
            <td></td>
        </tr>

        <!-- variable rows -->
        <tbody>
            {% for row in VARIABLE_TEMPLATE.itertuples() %}
                {% if row.type == 'v' %}
                    <tr class="variable-row">
                        <td></td>
                        <td></td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>

        <!-- TSP rows -->
        <tbody>
            {% for row in VARIABLE_TEMPLATE.itertuples() %}
                {% if row.type == 't' %}
                    <tr class="tsp-row">
                        <td></td>
                        <td></td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>

        <!-- non-custom ent/ded/alt rows -->
        <tbody>
            {% for i in range(19, row_headers|length - 6) %}
                {% set header = row_headers[i] %}
                {% set row_info = PAYDF_TEMPLATE[PAYDF_TEMPLATE['header'] == header] %}
                {% if row_info.shape[0] > 0 and not row_info.iloc[0]['custom'] %}
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>

        <!-- custom ent/ded/alt rows -->
        <tbody id="custom-button-section">
            {% for i in range(19, row_headers|length - 6) %}
                {% set header = row_headers[i] %}
                {% set row_info = PAYDF_TEMPLATE[PAYDF_TEMPLATE['header'] == header] %}
                {% if row_info.shape[0] > 0 and row_info.iloc[0]['custom'] %}
                    <tr data-header="{{ header }}">
                        <td>
                            <button class="button button-custom-row button-edit">&#9998;</button>
                        </td>
                        <td>
                            <button class="button button-custom-row button-remove">&#10005;</button>
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>


    <!-- paydf table -->
    <table id="paydf-table" class="pos-table">
        <tbody class="pos-table-section">
            <tr class="pos-table-header-row">
                <td class="pos-table-header-cell"></td>
                {% for col in col_headers[1:] %}
                    <td class="pos-table-header-cell">{{ col }}</td>
                {% endfor %}
            </tr>

            <!-- variable rows -->
            {% for row in VARIABLE_TEMPLATE.itertuples() %}
                {% if row.type == 'v' %}
                    {% set i = row_headers.index(row.header) %}
                    <tr class="variable-row">
                        <td class="row-header-cell">
                            <button class="modal-button" data-modal="{{ row.modal }}">
                                {{ row.header }}
                            </button>
                        </td>
                        {% for x in range(1, paydf.shape[1]) %}
                            {% set value = paydf.at[i, col_headers[x]] %}
                            <td>
                                {{ value }}
                            </td>
                        {% endfor %}
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>

        <!-- tsp rows -->
        <tbody class="pos-table-section">
            {% for row in VARIABLE_TEMPLATE.itertuples() %}
                {% if row.type == 't' %}
                    {% set i = row_headers.index(row.header) %}
                    <tr class="tsp-row">
                        <td class="row-header-cell">
                            <button class="modal-button" data-modal="{{ row.modal }}">
                                {{ row.header }}
                            </button>
                        </td>
                        {% for x in range(1, paydf.shape[1]) %}
                            {% set value = paydf.at[i, col_headers[x]] %}
                            <td>
                                {{ '{}%'.format(value) }}
                            </td>
                        {% endfor %}
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>


        <!-- ent/ded/alt rows -->
        <tbody class="pos-table-section">
            {% for i in range(19, row_headers|length - 6) %}
                {% set header = row_headers[i] %}
                {% set row_info = PAYDF_TEMPLATE[PAYDF_TEMPLATE['header'] == header] %}
                {% if row_info.shape[0] > 0 and not row_info.iloc[0]['custom'] %}
                    <tr>
                        <td class="row-header-cell">
                            <button class="modal-button" data-modal="{{ row_info.iloc[0]['modal'] }}">
                                {{ header }}
                            </button>
                        </td>
                        {% for x in range(1, paydf.shape[1]) %}
                            {% set value = paydf.at[i, col_headers[x]] %}
                            <td>
                                {{ '${:,.2f}'.format(value).replace('$-','-$') }}
                            </td>
                        {% endfor %}
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>

        <!-- custom rows-->
        <tbody id="custom-row-section" class="pos-table-section">
            {% for i in range(0, row_headers|length) %}
                {% set header = row_headers[i] %}
                {% set row_info = PAYDF_TEMPLATE[PAYDF_TEMPLATE['header'] == header] %}
                {% if row_info.shape[0] > 0 and row_info.iloc[0]['custom'] %}
                    <tr class="custom-row" data-header="{{ header }}">
                        <td>
                            {{ header }}
                        </td>
                        {% for x in range(1, paydf.shape[1]) %}
                            {% set value = paydf.at[i, col_headers[x]] %}
                            <td>
                                {% if value is not none and value != '' %}
                                    {{ '${:,.2f}'.format(value).replace('$-','-$') }}
                                {% else %}
                                    $0.00
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>

        <!-- calculation rows -->
        <tbody>
            {% for row in VARIABLE_TEMPLATE.itertuples() %}
                {% if row.type == 'c' %}
                    {% set i = row_headers.index(row.header) %}
                    <tr>
                        <td class="row-header-cell {% if row.header == 'Difference' %} difference-cell{% endif %}">
                            {% if row.header != "Difference" %}
                                <button class="modal-button" data-modal="{{ row.modal }}">
                                    {{ row.header }}
                                </button>
                            {% else %}
                                {{ row.header }}
                            {% endif %}
                        </td>
                        {% for x in range(1, paydf.shape[1]) %}
                            {% set value = paydf.at[i, col_headers[x]] %}
                            <td>
                                {{ '${:,.2f}'.format(value).replace('$-','-$') }}
                            </td>
                        {% endfor %}
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>