{% set PAYDF_TEMPLATE = config.PAYDF_TEMPLATE %}
{% set VARIABLE_TEMPLATE = config.VARIABLE_TEMPLATE %}

<form id="options-form">
    {{ options_form.hidden_tag() }}
    <table id="options-table" class="pos-table">
        <tbody class="pos-table-section">
            <tr class="pos-table-header-row">
                <td class="pos-table-header-cell"></td>
                <td class="pos-table-header-cell">Current</td>
                <td class="pos-table-header-cell">Future</td>
                <td class="pos-table-header-cell">Month</td>
            </tr>

            <!-- variable option rows -->
            {% for row in VARIABLE_TEMPLATE.itertuples() %}
                {% if row.type == 'v' and row.option %}
                    {% set varname = row.varname %}
                    {% set field_f = options_form[varname ~ '_f'] %}
                    {% set field_m = options_form[varname ~ '_m'] %}
                    {% set current_value = field_f.data %}
                    <tr>
                        <td class="row-header-cell">
                            <button class="modal-button" type="button" data-modal="{{ row.modal }}">{{ row.header }}</button>
                        </td>
                        <td>{{ current_value }}</td>
                        <td>
                            {% if varname == 'zip_code' %}
                                {{ field_f(class="input-num input-num-long", value=current_value, placeholder=current_value) }}
                            {% elif varname == 'dependents' %}
                                {{ field_f(class="input-num input-num-long", value=current_value, placeholder="0-9") }}
                            {% else %}
                                {{ field_f(class="dropdown" if field_f.type == 'SelectField' else "input-num input-num-long") }}
                            {% endif %}
                        </td>
                        <td>
                            {{ field_m(class="dropdown month-dropdown") }}
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>

        <!-- ent/ded/alt option rows -->
        <tbody class="pos-table-section">
            {% for subform in options_form.ent_ded_alt_rows %}
                <tr>
                    <td class="row-header-cell">
                        <button class="modal-button" type="button" data-modal="{{ PAYDF_TEMPLATE[PAYDF_TEMPLATE['header'] == subform.header.data].iloc[0]['modal'] }}">{{ subform.header.data }}</button>
                    </td>
                    <td>
                        {{ ('$' ~ '{:,.2f}'.format(subform.value_f.data)).replace('$-','-$') }}
                    </td>
                    <td>
                        {% set sign = '-' if PAYDF_TEMPLATE[PAYDF_TEMPLATE['header'] == subform.header.data].iloc[0]['sign'] == -1 or subform.value_f.data < 0 else '' %}
                        <span>{{ sign }}$</span>
                        {{ subform.value_f(class="input-num input-num-long", value=subform.value_f.data|abs) }}
                    </td>
                    <td>
                        {{ subform.value_m(class="dropdown month-dropdown") }}
                    </td>
                </tr>
            {% endfor %}
        </tbody>

        <!-- TSP rate option rows -->
        <tbody class="pos-table-section">
            {% for row in VARIABLE_TEMPLATE.itertuples() %}
                {% if row.type == 't' and row.option %}
                    {% set varname = row.varname %}
                    {% set field_f = options_form[varname ~ '_f'] %}
                    {% set field_m = options_form[varname ~ '_m'] %}
                    {% set current_value = field_f.data %}
                    <tr class="tsp-row">
                        <td class="row-header-cell">
                            <button class="modal-button" type="button" data-modal="{{ row.modal }}">{{ row.header }}</button>
                        </td>
                        <td>{{ current_value }}<span>%</span></td>
                        <td>
                            {{ field_f(class="input-num input-num-mid tsp-rate-input") }}<span>&nbsp;&nbsp;%</span>
                        </td>
                        <td>
                            {{ field_m(class="dropdown month-dropdown") }}
                        </td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>

        <!-- update LES button -->
        <tbody>
            <tr>
                <td colspan="4">
                    {{ options_form.update_les(id="update-les-button", class="button button-standard") }}
                </td>
            </tr>
        </tbody>
    </table>
</form>